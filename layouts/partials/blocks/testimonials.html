{{/* Bloque: testimonials (name/image/text -> author/avatar/quote) */}}
{{- $b := .block -}}
{{- $content := or (index $b "content") (dict) -}}

{{- $items := index $content "items" | default (slice) -}}
{{- if eq (len $items) 0 }}{{ return }}{{ end -}}

<section class="section testimonials" id="{{ index $b "id" | default "" }}">
  <div class="container">
    {{ with (index $content "title") }}<h2 class="text-center mb-4">{{ . | markdownify }}</h2>{{ end }}
    {{ with (index $content "subtitle") }}<p class="lead text-center mb-5">{{ . | markdownify }}</p>{{ end }}

    <div class="row g-4 justify-content-center">
      {{ range $t := $items }}
        {{- $quote  := or (index $t "quote") (index $t "text") -}}
        {{- $author := or (index $t "author") (index $t "name") -}}
        {{- $role   := index $t "role" -}}
        {{- $avatar := or (index $t "avatar") (index $t "image") -}}
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              {{ with $quote }}<div class="mb-3"><span class="fs-4">“</span>{{ . | markdownify }}<span class="fs-4">”</span></div>{{ end }}
              <div class="mt-auto d-flex align-items-center gap-3">
                {{ with $avatar }}
                  <img src="{{ (printf "/media/%s" .) | relURL }}" alt="{{ $author | default "Testimonio" }}" class="rounded-circle" width="48" height="48" loading="lazy">
                {{ end }}
                <div>
                  {{ with $author }}<div class="fw-semibold">{{ . }}</div>{{ end }}
                  {{ with $role }}<div class="text-muted small">{{ . }}</div>{{ end }}
                </div>
              </div>
            </div>
          </div>
        </div>
      {{ end }}
    </div>

    {{ with (index $content "note") }}<p class="small text-muted text-center mt-4">{{ . | markdownify }}</p>{{ end }}
  </div>
</section>
