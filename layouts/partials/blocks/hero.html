{{/* Bloque: hero (full-screen, centrado, background robusto) */}}
{{- $sec := .block | default (dict) -}}
{{- $c := (index $sec "content") | default (dict) -}}
{{- $design := (index $sec "design") | default (dict) -}}
{{- $css := (index $design "css_class") | default "" -}}

{{/* Alineación */}}
{{- $align := (index $c "align") | default "center" -}}
{{- $textAlign := cond (eq $align "center") "text-center" (cond (eq $align "end") "text-end" "text-start") -}}
{{- $justify := cond (eq $align "center") "justify-content-center" (cond (eq $align "end") "justify-content-end" "justify-content-start") -}}

{{/* Fondo */}}
{{- $bg := (index $design "background") | default (dict) -}}
{{- $bgColor := (index $bg "color") | default "" -}}
{{- $imgConf := (index $bg "image") | default (dict) -}}
{{- $imgName := (index $imgConf "filename") | default "" -}}
{{- $pos := (index $imgConf "position") | default "center" -}}
{{- $filters := (index $imgConf "filters") | default (dict) -}}
{{- $brightness := (index $filters "brightness") | default 0 -}}
{{- $overlay := (index $bg "overlay") | default 0.45 -}}

{{/* URL del fondo: 1) estática /media 2) assets/media si existe */}}
{{- $imgURL := "" -}}
{{- if ne $imgName "" -}}
  {{- $imgURL = (printf "/media/%s" $imgName | relURL) -}}  {{/* fallback estático SIEMPRE válido si el archivo está en static/media */}}
  {{- with resources.Get (printf "media/%s" $imgName) -}}    {{/* si existe en assets/media lo usamos */}}
    {{- $imgURL = .RelPermalink -}}
  {{- end -}}
{{- end -}}

{{/* Spacing y alto completo */}}
{{- $spacing := (index $design "spacing") | default (dict) -}}
{{- $pad := (index $spacing "padding") | default (slice) -}}
{{- $mar := (index $spacing "margin") | default (slice) -}}
{{- $padCss := cond (gt (len $pad) 0) (printf "padding:%s;" (delimit $pad " ")) "" -}}
{{- $marCss := cond (gt (len $mar) 0) (printf "margin:%s;" (delimit $mar " ")) "" -}}

{{- $dark := or (eq $css "dark") (in $css "bg-dark") -}}

<section id="section-hero" class="position-relative blox-hero {{ $css }}" style="min-height:100vh; {{ $padCss }} {{ $marCss }}">
  {{/* Capa de fondo independiente (asegura render) */}}
  <div class="position-absolute top-0 start-0 w-100 h-100" aria-hidden="true"
       style="
         {{ if $bgColor }}background-color: {{ $bgColor }};{{ end }}
         {{ if $imgURL }}background-image:url('{{ $imgURL }}'); background-size:cover; background-position:{{ $pos }};{{ end }}
         {{ if and $imgURL (gt (float $brightness) 0) }}filter: brightness({{ $brightness }});{{ end }}
       ">
  </div>

  {{/* Overlay para contraste */}}
  {{- if or $dark (ne $imgURL "") -}}
    <div class="position-absolute top-0 start-0 w-100 h-100" aria-hidden="true"
         style="background-color:rgba(0,0,0,{{ $overlay }});"></div>
  {{- end -}}

  <div class="container position-relative d-flex {{ $justify }}" style="min-height:100vh;">
    <div class="row flex-grow-1 w-100">
      <div class="col-12 d-flex {{ $justify }} align-items-center">
        <div class="{{ $textAlign }}" style="max-width:42rem;">
          {{ with (index $c "title") }}
            <h1 class="display-4 fw-bold {{ if $dark }}text-white{{ else }}text-body{{ end }}">{{ . }}</h1>
          {{ end }}
          {{ with (index $c "subtitle") }}
            <p class="lead mt-3 {{ if $dark }}text-white-50{{ else }}text-muted{{ end }}">{{ . | markdownify }}</p>
          {{ end }}

          {{- $pa := (index $c "primary_action") | default (dict) -}}
          {{- $paText := or (index $pa "text") (index $pa "label") -}}
          {{- $paURL  := index $pa "url" -}}
          {{- $sa := (index $c "secondary_action") | default (dict) -}}
          {{- $saText := or (index $sa "text") (index $sa "label") -}}
          {{- $saURL  := index $sa "url" -}}

          <div class="mt-4 d-flex flex-wrap gap-2 {{ $justify }}">
            {{ if and $paText $paURL }}<a class="btn btn-primary btn-lg" href="{{ $paURL }}">{{ $paText }}</a>{{ end }}
            {{ if and $saText $saURL }}<a class="btn btn-outline-light btn-lg" href="{{ $saURL }}">{{ $saText }}</a>{{ end }}
          </div>
        </div>
      </div>
    </div>
  </div>

  {{/* Log de ayuda en build si no se resolvió la imagen */}}
  {{- if and (ne $imgName "") (eq $imgURL "") -}}
    {{- warnf "Hero: no se encontró '%s' en assets/media ni en static/media." $imgName -}}
  {{- end -}}
</section>
