{{/* =============== CTA IMAGE + PARAGRAPH =============== */}}

{{/* 1) Intentar usar el bloque que llega del parser */}}
{{- $pg := or (index . "page") .Page -}}
{{- $sec := or (index . "block") dict -}}

{{/* 2) Si no vino `block`, resolverlo por nombre de partial dentro de sections */}}
{{- if not (isset $sec "content") -}}
  {{- $secs := (index $pg.Params "sections") | default (slice) -}}
  {{- $tmpl := .Template.Name -}}                       {{/* p.ej. _partials/blocks/cta-image-paragraph.html */}}
  {{- $bname := replace (path.Base $tmpl) ".html" "" -}} {{/* cta-image-paragraph */}}
  {{- $matches := where $secs "block" $bname -}}
  {{- if gt (len $matches) 0 -}}
    {{- $sec = index $matches 0 -}}
  {{- end -}}
{{- end -}}

{{/* 3) Normalizar contenido y dise√±o */}}
{{- $c := index $sec "content" -}}
{{- if not $c -}} {{- $c = $sec -}} {{- end -}}
{{- $design := (index $sec "design") | default (dict) -}}
{{- $css    := (index $design "css_class") -}}
{{- $items  := (index $c "items") | default (slice) -}}

<section class="section {{ $css }}">
  <div class="container">

    {{ if gt (len $items) 0 }}
      {{ range $it := $items }}
        {{- $title    := index $it "title" -}}
        {{- $text     := or (index $it "text") (index $it "body") (index $it "markdown") -}}
        {{- $img      := index $it "image" -}}
        {{- $btn      := index $it "button" -}}
        {{- $btn_text := or (index $btn "text") (index $btn "label") -}}
        {{- $btn_url  := index $btn "url" -}}
        {{- $features := (index $it "features") | default (slice) -}}

        <div class="row g-4 align-items-center mb-5">
          <div class="col-md-6 {{ if $img }}order-md-2{{ end }}">
            {{ with $img }}<img class="img-fluid rounded shadow-sm" src="{{ (printf "/media/%s" .) | relURL }}" alt="">{{ end }}
          </div>
          <div class="col-md-6 {{ if $img }}order-md-1{{ end }}">
            {{ with $title }}<h2 class="mb-3">{{ . | markdownify }}</h2>{{ end }}
            {{ with $text  }}<div class="lead">{{ . | markdownify }}</div>{{ end }}

            {{ if gt (len $features) 0 }}
              <ul class="mt-3">
                {{ range $f := $features }}<li>{{ $f }}</li>{{ end }}
              </ul>
            {{ end }}

            {{ if and $btn_url $btn_text }}
              <a class="btn btn-primary mt-3" href="{{ $btn_url }}">{{ $btn_text }}</a>
            {{ end }}
          </div>
        </div>
      {{ end }}
    {{ else }}
      {{- $title := index $c "title" -}}
      {{- $text  := or (index $c "text") (index $c "body") (index $c "markdown") -}}
      {{- $img   := index $c "image" -}}

      <div class="row g-4 align-items-center">
        <div class="col-md-6 {{ if $img }}order-md-2{{ end }}">
          {{ with $img }}<img class="img-fluid rounded shadow-sm" src="{{ (printf "/media/%s" .) | relURL }}" alt="">{{ end }}
        </div>
        <div class="col-md-6 {{ if $img }}order-md-1{{ end }}">
          {{ with $title }}<h2 class="mb-3">{{ . | markdownify }}</h2>{{ end }}
          {{ with $text  }}<div class="lead">{{ . | markdownify }}</div>{{ end }}
        </div>
      </div>
    {{ end }}

  </div>
</section>
