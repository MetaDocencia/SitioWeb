{{/* Bloque: cta-image-paragraph */}}
{{- $pg := .Page -}}
{{- $sec := .block | default (dict) -}}
{{- $c := (index $sec "content") | default (dict) -}}
{{- $design := (index $sec "design") | default (dict) -}}
{{- $css := (index $design "css_class") | default "" -}}

{{- $items := (index $c "items") | default (slice) -}}

<section class="section {{ $css }}">
  <div class="container">
    {{ if gt (len $items) 0 }}
      {{ range $it := $items }}
        {{- $title := index $it "title" -}}
        {{- $text  := or (index $it "text") (index $it "body") -}}
        {{- $imgName := index $it "image" -}}
        {{- $btn := index $it "button" -}}
        {{- $btnText := or (index $btn "label") (index $btn "text") -}}
        {{- $btnURL := index $btn "url" -}}
        {{- $features := (index $it "features") | default (slice) -}}

        {{- $res := cond $imgName (resources.Get (printf "media/%s" $imgName)) nil -}}

        <div class="row g-4 align-items-center mb-5">
          <div class="col-md-6 {{ if $imgName }}order-md-2{{ end }}">
            {{ if $res }}
              <img class="img-fluid rounded shadow-sm" src="{{ $res.RelPermalink }}" alt="">
            {{ else if $imgName }}
              <img class="img-fluid rounded shadow-sm" src="{{ (printf "/media/%s" $imgName) | relURL }}" alt="">
            {{ end }}
          </div>
          <div class="col-md-6 {{ if $imgName }}order-md-1{{ end }}">
            {{ with $title }}<h2 class="mb-3">{{ . }}</h2>{{ end }}
            {{ with $text }}<div class="lead">{{ . | markdownify }}</div>{{ end }}

            {{ if gt (len $features) 0 }}
              <ul class="mt-3">
                {{ range $f := $features }}<li>{{ $f }}</li>{{ end }}
              </ul>
            {{ end }}

            {{ if and $btnText $btnURL }}
              <a class="btn btn-primary mt-3" href="{{ $btnURL }}">{{ $btnText }}</a>
            {{ end }}
          </div>
        </div>
      {{ end }}
    {{ else }}
      {{- $title := index $c "title" -}}
      {{- $text  := or (index $c "text") (index $c "body") -}}
      {{- $imgName := index $c "image" -}}
      {{- $res := cond $imgName (resources.Get (printf "media/%s" $imgName)) nil -}}

      <div class="row g-4 align-items-center">
        <div class="col-md-6 {{ if $imgName }}order-md-2{{ end }}">
          {{ if $res }}
            <img class="img-fluid rounded shadow-sm" src="{{ $res.RelPermalink }}" alt="">
          {{ else if $imgName }}
            <img class="img-fluid rounded shadow-sm" src="{{ (printf "/media/%s" $imgName) | relURL }}" alt="">
          {{ end }}
        </div>
        <div class="col-md-6 {{ if $imgName }}order-md-1{{ end }}">
          {{ with $title }}<h2 class="mb-3">{{ . }}</h2>{{ end }}
          {{ with $text }}<div class="lead">{{ . | markdownify }}</div>{{ end }}
        </div>
      </div>
    {{ end }}
  </div>
</section>
