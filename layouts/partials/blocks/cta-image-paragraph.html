<div style="padding:8px;margin:8px 0;border:2px dashed #09f;background:#eef">
  DEBUG: Entró al partial <strong>{{ .Template.Name }}</strong>
</div>

{{/* Bloque: cta-image-paragraph (robusto a shapes y claves) */}}
{{- $ctx := . -}}
{{- $b := or (index $ctx "block") $ctx -}}
{{- $content := or (index $b "content") $b -}}

{{- $items := index $content "items" -}}
{{- $hasItems := and $items (gt (len $items) 0) -}}

<section class="section cta-image-paragraph" id="{{ index $b "id" | default "" }}">
  <div class="container">
    {{/* Si viene como lista de items, renderizamos todos; si no, un bloque simple */}}
    {{- if $hasItems -}}
      <div class="row g-5 align-items-center">
        {{- range $it := $items -}}
          {{- $title := index $it "title" -}}
          {{- $text  := or (index $it "text") (index $it "body") (index $it "markdown") -}}
          {{- $img   := index $it "image" -}}
          {{- $btn   := index $it "button" -}}
          {{- $btnLabel := or (index $btn "label") (index $btn "text") -}}
          <div class="col-12 col-md-6">
            <div class="row g-4 align-items-center">
              <div class="col-12 {{ if $img }}col-md-5 order-md-2{{ end }}">
                {{ with $img }}<img src="{{ (printf "/media/%s" .) | relURL }}" alt="" class="img-fluid">{{ end }}
              </div>
              <div class="col-12 {{ if $img }}col-md-7 order-md-1{{ end }}">
                {{ with $title }}<h2 class="mb-3">{{ . | markdownify }}</h2>{{ end }}
                {{ with $text  }}<div class="lead">{{ . | markdownify }}</div>{{ end }}
                {{ with $btn }}<a class="btn btn-primary mt-3" href="{{ index . "url" }}">{{ $btnLabel | default "Más info" }}</a>{{ end }}
              </div>
            </div>
          </div>
        {{- end -}}
      </div>
    {{- else -}}
      {{- $title := index $content "title" -}}
      {{- $text  := or (index $content "text") (index $content "body") (index $content "markdown") -}}
      {{- $img   := index $content "image" -}}
      {{- $btn   := index $content "button" -}}
      {{- $btnLabel := or (index $btn "label") (index $btn "text") -}}
      <div class="row g-5 align-items-center">
        <div class="col-12 {{ if $img }}col-md-6 order-md-2{{ end }}">
          {{ with $img }}<img src="{{ (printf "/media/%s" .) | relURL }}" alt="" class="img-fluid">{{ end }}
        </div>
        <div class="col-12 {{ if $img }}col-md-6 order-md-1{{ end }}">
          {{ with $title }}<h2 class="mb-3">{{ . | markdownify }}</h2>{{ end }}
          {{ with $text  }}<div class="lead">{{ . | markdownify }}</div>{{ end }}
          {{ with $btn }}<a class="btn btn-primary mt-3" href="{{ index . "url" }}">{{ $btnLabel | default "Más info" }}</a>{{ end }}
        </div>
      </div>
    {{- end -}}
  </div>
</section>
