{{/* Resolver el bloque por nombre de template */}}
{{- $pg := or (index . "page") .Page -}}
{{- $secs := (index $pg.Params "sections") | default (slice) -}}
{{- $tmpl := .Template.Name -}}             {{/* _partials/blocks/cta-image-paragraph.html */}}
{{- $bname := replace (path.Base $tmpl) ".html" "" -}}  {{/* cta-image-paragraph */}}
{{- $sec := (where $secs "block" $bname) | first -}}
{{- $c := (index $sec "content") | default (dict) -}}
{{- $items := (index $c "items") -}}

<section class="section" id="{{ index $sec "id" | default "" }}">
  <div class="container">
    {{ if and $items (gt (len $items) 0) }}
      {{ range $it := $items }}
        {{- $title := index $it "title" -}}
        {{- $text  := or (index $it "text") (index $it "body") (index $it "markdown") -}}
        {{- $img   := index $it "image" -}}
        {{- $btn   := index $it "button" -}}
        {{- $btnLabel := or (index $btn "label") (index $btn "text") -}}
        <div class="row g-4 align-items-center mb-4">
          <div class="col-md-6 order-md-2">
            {{ with $img }}<img class="img-fluid" src="{{ (printf "/media/%s" .) | relURL }}" alt="">{{ end }}
          </div>
          <div class="col-md-6 order-md-1">
            {{ with $title }}<h2 class="mb-2">{{ . | markdownify }}</h2>{{ end }}
            {{ with $text  }}<div class="lead">{{ . | markdownify }}</div>{{ end }}
            {{ with $btn }}<a class="btn btn-primary mt-3" href="{{ index . "url" }}">{{ $btnLabel | default "MÃ¡s info" }}</a>{{ end }}
          </div>
        </div>
      {{ end }}
    {{ else }}
      {{- $title := index $c "title" -}}
      {{- $text  := or (index $c "text") (index $c "body") (index $c "markdown") -}}
      {{- $img   := index $c "image" -}}
      <div class="row g-4 align-items-center">
        <div class="col-md-6 order-md-2">
          {{ with $img }}<img class="img-fluid" src="{{ (printf "/media/%s" .) | relURL }}" alt="">{{ end }}
        </div>
        <div class="col-md-6 order-md-1">
          {{ with $title }}<h2 class="mb-2">{{ . | markdownify }}</h2>{{ end }}
          {{ with $text  }}<div class="lead">{{ . | markdownify }}</div>{{ end }}
        </div>
      </div>
    {{ end }}
  </div>
</section>
